(()=>{function b(t,i){return e=>(1-e)*t+e*i}function y(t){return t/180*Math.PI}function x(t){return[[1,0,t[0]],[0,1,t[1]],[0,0,1]]}function D(t){return[[t[0],0,0],[0,t[1],0],[0,0,1]]}function L(t){return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]}function V(t){let i=[];for(let e=0;e<t;e++){i.push([]);for(let l=0;l<t;l++)i[e][l]=e==l?1:0}return i}function k(t){let i=0;for(let e=0;e<t.length;e++)i+=t[e]**2;return Math.sqrt(i)}function A(t){let i=k(t);for(let e=0;e<t.length;e++)t[e]/=i}function _(t,i){for(let e=0;e<t.length;e++)t[e]*=i}function m(t,i){let e=[];for(let l=0;l<t.length;l++)e.push(t[l]*i);return e}function p(t,i){let e=[];for(let l=0;l<t.length;l++){let a=0;for(let o=0;o<t[l].length;o++)a+=t[l][o]*i[o];e.push(a)}return e}function B(t,i){for(let e=0;e<t.length;e++)t[e]+=i[e]}function w(t,i){let e=[],l=Math.min(t.length,i[0].length);for(let a=0;a<t.length;a++){e.push([]);for(let o=0;o<i[0].length;o++){e[a][o]=0;for(let n=0;n<l;n++)e[a][o]+=t[a][n]*i[n][o]}}return e}function j(t,i){t.fillRect(0,0,i.width,i.height)}function K(t,i,e,l){t.beginPath(),t.arc(i,e,l,0,2*Math.PI),t.closePath(),t.fill()}function I(t,i){t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(let e=1;e<i.length;e++)t.lineTo(i[e][0],i[e][1]);t.closePath(),t.stroke()}function q(t,i){t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(let e=1;e<i.length;e++)t.lineTo(i[e][0],i[e][1]);t.closePath(),t.fill()}function z(t,i,e,l,a){let o=50,n=Math.random()*i**3*6-3,h=Math.random()*i**3*6-3,r=e[0]+n,f=e[1]+h;t.beginPath(),t.moveTo(r,f),t.arc(r,f,o,y(l),y(Math.random()*i**3*10+l+i*(a-10))),t.lineTo(r,f),t.fill(),t.beginPath(),t.moveTo(r,f),t.arc(r,f,o,y(l),y(l+a)),t.lineTo(r,f),t.stroke()}function X(t,i,e){for(let l=0;l<i.length;l++)K(t,i[l][0],i[l][1],e)}var u={drawSpeedometr:z,drawStars:X,fillCanvas:j,fillCircle:K,strokePolygon:I,fillPolygon:q};var P=class{constructor(i){this.stars=[];for(let e=0;e<i;e++)this.stars.push([Math.random()*M,Math.random()*d,1]);this.transformMatrix=V(3)}update(i){this.transformMatrix=x(i);for(let e=0;e<this.stars.length;e++)this.stars[e]=p(this.transformMatrix,this.stars[e]),this.stars[e][0]=((this.stars[e][0]+c/2)%M+M)%M-c/2,this.stars[e][1]=((this.stars[e][1]+g/2)%d+d)%d-g/2}},T=class{constructor(i,e,l,a,o=!1){this.midPosition=[...i],this.moveMid=o?function(n){let h=m(this.velocityNormal,this.currentSpeed);this.midPosition[0]+=h[0]*n,this.midPosition[1]+=h[1]*n,this.midPosition[0]=((this.midPosition[0]+c/2)%M+M)%M-c/2,this.midPosition[1]=((this.midPosition[1]+g/2)%d+d)%d-g/2}:()=>{},this.acceleration=e,this.rotateSpeed=l,this.maxSpeed=a,this.speedRemap=b(1.6,.8),this.currentSpeed=0,this.velocityNormal=[0,-1,0],this._flame=[[-5,5,1],[0,18,1],[5,5,1],[0,0,1]],this.flame=[[-5,5,1],[0,18,1],[5,5,1],[0,0,1]],this._body=[[-15,6,1],[0,-27,1],[15,6,1],[0,0,1]],this.body=[[-15,6,1],[0,-27,1],[15,6,1],[0,0,1]],this.forwardVector=[0,-1,0],this.angle=0,this.rotateMatrix=V(3)}rotate(i,e){this.angle=((this.angle+i*e)%360+360)%360,this.rotateMatrix=L(y(this.angle)),this.forwardVector=p(this.rotateMatrix,[0,-1,0])}accelerate(i){let e=m(this.forwardVector,this.acceleration*i);_(this.velocityNormal,this.currentSpeed),B(this.velocityNormal,e),this.currentSpeed=Math.min(k(this.velocityNormal),this.maxSpeed),A(this.velocityNormal)}get speedF(){return this.currentSpeed/this.maxSpeed}getTransformMatrix(){return w(x(this.midPosition),this.rotateMatrix)}update(i){this.moveMid(i);let e=this.getTransformMatrix();this.body=[];for(let o=0;o<this._body.length;o++){let n=p(e,this._body[o]);this.body.push(n)}this.flame=[];let l=this.speedF,a=w(e,D([1,this.speedRemap(l**3)]));for(let o=0;o<this._flame.length;o++){let n=p(a,this._flame[o]);this.flame.push(n)}}};function Y(t){switch(t.code){case"KeyW":s.KeyW=!0;break;case"KeyA":s.KeyA=!0,s.KeyD=!1;break;case"KeyD":s.KeyA=!1,s.KeyD=!0;break}}function $(t){switch(t.code){case"KeyW":case"KeyA":case"KeyD":s[t.code]=!1;break}}function J(t,i){s.KeyA&&t.rotate(-t.rotateSpeed,i),s.KeyD&&t.rotate(t.rotateSpeed,i),s.KeyW&&t.accelerate(i),s.Space}var c=40,g=40,R=document.body.clientWidth,v=800,M=R+c,d=v+g,s={KeyW:!1,KeyA:!1,KeyD:!1,Space:!1};function U(){let t=b(255,0),i=[R-40,v-30],e=160,l=140,a=new T([M/2,d/2],300,200,800,!0),o=new P(50),n=new P(200),h=document.getElementById("main-canvas");h.setAttribute("width",R),h.setAttribute("height",v);let r=h.getContext("2d");document.addEventListener("keypress",Y),document.addEventListener("keyup",$),r.lineJoin="round",r.lineCap="round",r.lineWidth=1.5,r.strokeStyle="#fff",r.font="24px Chakra Petch";let f;function N(W=0){let S=(W-f)/1e3||0;f=W,J(a,S),a.update(S,s),o.update(m(a.velocityNormal,-.06*a.currentSpeed*S)),n.update(m(a.velocityNormal,-.04*a.currentSpeed*S)),r.fillStyle="#000",u.fillCanvas(r,h),r.fillStyle="#fff",u.drawStars(r,o.stars,1.2),u.drawStars(r,n.stars,.8),r.lineWidth=3,u.strokePolygon(r,a.body),r.lineWidth=1.5,r.fillStyle="#000",u.fillPolygon(r,a.body),r.fillStyle="#fff",s.KeyW&&(r.fillStyle="#fff",u.fillPolygon(r,a.flame));let E=a.speedF,C=Math.floor(t(E**3));r.fillStyle=`rgb(255, ${C}, ${C})`,u.drawSpeedometr(r,E,i,e,l),requestAnimationFrame(N)}N()}U();})();
